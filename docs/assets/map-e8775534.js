var Q=Object.defineProperty;var V=(a,t,e)=>t in a?Q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var d=(a,t,e)=>(V(a,typeof t!="symbol"?t+"":t,e),e);import{a as tt,f as et}from"./snackbar-6caacc16.js";class st{constructor(){const t=document.querySelector("app-map");Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5MjY2YmYxNy1mNTM2LTRlOWYtYTUyZC01ZmY0NjBhNzllMWEiLCJpZCI6MTY5MDU3LCJpYXQiOjE2OTU4ODQ4NzB9.bN66rOR5h37xuKVsuUSYRSLOGJy-34IhH9S1hr4NOOE",this.viewer=new Cesium.Viewer(t,{baseLayerPicker:!1,geocoder:!1,timeline:!1,animation:!1,homeButton:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,sceneModePicker:!1,fullscreenButton:!1,infoBox:!1})}changeTheme(t){const e=this.viewer.imageryLayers._layers[1];if(this.viewer.imageryLayers.remove(e),t!=""){t=JSON.parse(t);const s=this.getImageryProvider(t.url,t.layer,t.credit);this.viewer.imageryLayers.addImageryProvider(s)}}async fetchThemes(t){return await fetch(t).then(s=>s.json())}getImageryProvider(t,e,s){return new Cesium.WebMapTileServiceImageryProvider({url:t,layer:e,style:"default",format:"image/jpeg",maximumLevel:19,tileMatrixSetID:"default",credit:new Cesium.Credit(s)})}onClick(t,e){const s=t.position,i=this.viewer.scene.pick(s);if(!i||i==null)return;if(Array.isArray(i.id)){this.viewer.zoomTo(i.id);return}const o=this.getLayerToFind(i.id),n=this.filterLayerByName(e,o);let r,l;i.primitive._position&&(r=i.primitive._position,l=this.cartesianToCartographic(r));const c=i.id.properties,h=n.relevant_properties,p=n.name,f=this.getRelevantProperties(c,h,p);let m={};return m.properties=f,m.layer=n,l&&(m.coordinates=l),m}getLayerToFind(t){if(t==null)return;let e;switch(!0){case t.id.includes("."):e=t.id.split(".")[0];break;case t.id.includes("/"):e=t.id.split("/")[0];break}return e}cartesianToCartographic(t){const e=Cesium.Cartographic.fromCartesian(t),s=Cesium.Math.toDegrees(e.longitude),i=Cesium.Math.toDegrees(e.latitude);return{longitude:s,latitude:i}}mouseOver(t){const e=t.endPosition,s=this.viewer.scene.pick(e);Cesium.defined(s)&&Cesium.defined(s.id)?document.body.style.cursor="pointer":document.body.style.cursor="default"}createInfobox(t,e,s,i){let o=!1;if(e.forEach(n=>{n.getAttribute("data")===JSON.stringify(s)&&(o=!0)}),!o&&s){const n=document.createElement("app-infobox");n.setAttribute("data",JSON.stringify(s)),t++,n.setAttribute("uuid",t),i.append(n)}}filterLayerByName(t,e){for(const s in t){const i=t[s];if(Array.isArray(i)||typeof i=="object"){const o=this.filterLayerByName(i,e);if(o)return o}else if(typeof i=="string"&&i.includes(e))return t}return null}getRelevantProperties(t,e,s){const i={};if(e){for(const o of e)o.property_name&&t[o.property_name]&&(i[o.display_name]=t[o.property_name]._value);return i.Title=s,i}return i}startNavigation(t){const e=this.convertCoordinates(t),s=`https://www.google.com/maps/dir/?api=1&destination=${e.latitude},${e.longitude}`;window.open(s,"_blank")}convertCoordinates(t){const e=this.viewer.scene.pickPosition(t),s=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(s.longitude),o=Cesium.Math.toDegrees(s.latitude);return{longitude:i,latitude:o}}goto(t){const e=`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`;window.open(e,"_blank")}async handleCheckbox(t,e){const s=t.map(i=>this.fetchLayerData(i).then(o=>({layer:i,data:o})));await Promise.all(s).then(async i=>{this.viewer.dataSources.removeAll(),await Promise.all(i.map(async r=>{const l=await r.data.layer;this.viewer.dataSources.add(l),await this.styleEntities(l,r.layer.style)}));const o=this.combineDataSource(),n=await this.clusterAllEntities(e,o);this.viewer.dataSources.add(n)})}async checkLayerToRemove(t,e){t.forEach(s=>{const i=e.findIndex(o=>o.layer===s.layer);i!==-1&&e.splice(i,1)})}async fetchLayerData(t){const e=`${t.layer_url_wfs}?service=WFS&typeName=${t.layer}&outputFormat=application/json&request=GetFeature&srsname=EPSG:4326`;return fetch(e).then(s=>s.json()).then(s=>({features:s.features,layer:Cesium.GeoJsonDataSource.load(s)})).catch(s=>{throw console.error(s),s})}async styleEntities(t,e){let s="YELLOW",i="YELLOW",o=.5;e&&e.color&&(s=e.color.toUpperCase(),i=e.color.toUpperCase()),e&&e.opacity&&(o=e.opacity),t.entities.values.forEach(n=>{switch(!0){case Cesium.defined(n.polyline):n.polyline.material=Cesium.Color[s].withAlpha(parseFloat(o)),n.polyline.width=2;break;case Cesium.defined(n.billboard):n.billboard=void 0,n.point=new Cesium.PointGraphics({pixelSize:18,color:Cesium.Color[i].withAlpha(parseFloat(o)),outlineColor:Cesium.Color.WHITE,outlineWidth:2});break;case Cesium.defined(n.polygon):n.polygon.material=Cesium.Color[s].withAlpha(parseFloat(o)),n.polygon.outlineColor=Cesium.Color[s].withAlpha(parseFloat(o));break}})}combineDataSource(){const t=this.viewer.dataSources,e=new Cesium.CustomDataSource;for(let i=0;i<t.length;i++)t.get(i).entities.values.forEach(o=>{e.entities.add(o)});const s=t.indexOf(e);for(let i=t.length-1;i>=0;i--)i!==s&&t.remove(t.get(i));return e}async clusterAllEntities(t,e){const s="WHITE";e.clustering.enabled=!0,e.clustering.pixelRange=25,e.clustering.minimumClusterSize=2;const i=t[0],o=t[1],n=t[2];return e.clustering.clusterEvent.addEventListener(async(r,l)=>{l.label.show=!1,l.billboard.show=!0,l.billboard.color=Cesium.Color.fromCssColorString(s),l.billboard.scale=.38,l.billboard.id=l.label.id;let c=[];switch(l.billboard.id.forEach(h=>{c.push(h.point.color.getValue()),c.length>4&&c.shift()}),!0){case r.length>=4:const h=this.styleClusterIcon(n,c),p=this.createClusterIconUrl(h);l.billboard.image=p;break;case r.length==3:const f=this.styleClusterIcon(o,c),m=this.createClusterIconUrl(f);l.billboard.image=m;break;case r.length==2:const v=this.styleClusterIcon(i,c),Z=this.createClusterIconUrl(v);l.billboard.image=Z;break}}),e}styleClusterIcon(t,e){let s=[];e.forEach(n=>{let r=Math.floor(n.red*255),l=Math.floor(n.green*255),c=Math.floor(n.blue*255),h={red:r,green:l,blue:c};s.push(h)});let i=0;const o=t.querySelectorAll("circle");if(o.length==4)o.forEach(n=>n.setAttribute("fill","#1E233A"));else for(let n=0;n<o.length;n++)o[n].setAttribute("fill",`rgb(${s[i].red}, ${s[i].green}, ${s[i].blue})`),i++;return t}createClusterIconUrl(t){let s=new XMLSerializer().serializeToString(t),i=new Blob([s],{type:"image/svg+xml"});return URL.createObjectURL(i)}removeLayerWFS(t){const e=this.viewer._dataSourceCollection._dataSources,s=e.length;for(let i=0;i<s;i++){const o=e.get(i);if(o._imageryProvider._layers===t){e.remove(o);return}}}removeAllLayers(){this.viewer.imageryLayers.removeAll()}getActiveLayers(){return this.viewer.imageryLayers._layers}removeAllEntities(t){const e=[];for(const s of t.values)s.name!=="user-position"&&e.push(s);for(const s of e)t.remove(s)}startNavigation(t){let e=1;t.forEach(s=>{this.createPathOrderLabels(s.coordinates,e),e++})}createPathOrderLabels(t,e){const s=t.longitude,i=t.latitude;this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(s,i,1),label:{text:`${e}`,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-20),scale:.5,scaleByDistance:new Cesium.NearFarScalar(150,1.5,8e6,0),fillColor:Cesium.Color.WHITE,outlineWidth:2,outlineColor:Cesium.Color.BLACK,style:Cesium.LabelStyle.FILL_AND_OUTLINE}})}async createRoute(t,e,s){const i=this.viewer.entities;if(this.removeAllEntities(i),s==null)return;let o=[];await Promise.all(s.map(async c=>{(await this.fetchEntitiesData(c)).features.forEach(p=>{(p.geometry.type=="Point"||p.geometry.type=="MultiPoint")&&o.push(p)})}));const n=this.orderFeaturesByProximity(e,o);let r=1;e.coords.longitude,e.coords.latitude,n.forEach(c=>{const h=this.findFeatureCoordinates(c);this.createPointsOrderLabels(h,r),r++}),n.forEach(c=>{const h=this.getLayerToFind(c),p=this.filterLayerByName(t,h);c.layer=p.layer,c.name=p.name,c.relevant_properties=p.relevant_properties}),n.forEach(c=>{c.properties=Object.entries(c.properties).reduce((h,[p,f])=>{const m=c.relevant_properties.find(v=>v.property_name===p);return m&&(h[m.display_name]=f),h},{})});let l=[];return n.forEach(c=>{const h={},p=c.properties;p.Title=c.name,h.properties=p;let f,m;if(Array.isArray(c.geometry.coordinates)){if(c.geometry.coordinates.length==1){f=c.geometry.coordinates[0][0],m=c.geometry.coordinates[0][1];const v={longitude:f,latitude:m};h.coordinates=v}else if(c.geometry.coordinates.length==2){f=c.geometry.coordinates[0],m=c.geometry.coordinates[1];const v={longitude:f,latitude:m};h.coordinates=v}}l.push(h)}),this.viewer.zoomTo(i),l}orderFeaturesByProximity(t,e){let s=[],i=[t.coords.longitude,t.coords.latitude];for(;e.length!=0;){let o=1/0,n=-1;for(let r=0;r<e.length;r++){let l=e[r];const c=this.calculateDistance(i,l);c<o&&(o=c,n=r)}s.push(e[n]),e.splice(n,1)}return s}async fetchEntitiesData(t){const e=`${t.layer_url_wfs}?service=WFS&typeName=${t.layer}&outputFormat=application/json&request=GetFeature&srsname=EPSG:4326`;try{return await(await fetch(e)).json()}catch(s){throw console.error("Errore durante la richiesta fetch:",s),s}}calculateDistance(t,e){const s=this.findFeatureCoordinates(e),i=Cesium.Cartographic.fromDegrees(t[0],t[1]),o=Cesium.Cartographic.fromDegrees(s[0],s[1]);return new Cesium.EllipsoidGeodesic(i,o).surfaceDistance}findFeatureCoordinates(t){let e=[];if(Array.isArray(t.geometry.coordinates)){let s=t.geometry.coordinates;s.length==1?s[0].forEach(i=>e.push(i)):(s.splice(2),s.forEach(i=>e.push(i)))}else e=[t.geometry.coordinates];return e}createPointsOrderLabels(t,e){const s=t[0],i=t[1];this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(s,i,1),label:{text:`${e}`,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-20),scale:.5,scaleByDistance:new Cesium.NearFarScalar(150,1.5,8e6,0),fillColor:Cesium.Color.WHITE,outlineWidth:2,outlineColor:Cesium.Color.BLACK,style:Cesium.LabelStyle.FILL_AND_OUTLINE}})}setCamera(){const t=Cesium.Cartesian3.fromDegrees(8.909041078781357,44.410209942448475,4e3);this.viewer.camera.flyTo({destination:t,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0}})}setCameraToPosition(t){const e=Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,4e3);this.viewer.camera.flyTo({destination:e,duration:.5,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0}})}setCameraToUserPosition(t){const e=Cesium.Cartesian3.fromDegrees(t.coords.longitude,t.coords.latitude,4e3);this.viewer.camera.flyTo({destination:e,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0}})}createUserPin(t){this.viewer.entities.add({name:"user-position",position:Cesium.Cartesian3.fromDegrees(t.coords.longitude,t.coords.latitude,0),ellipse:{semiMinorAxis:20,semiMajorAxis:20,height:0,material:Cesium.Color.BLUE,outline:!0,outlineColor:Cesium.Color.WHITE,outlineWidth:200}})}async addBuilding(){const t=await Cesium.createOsmBuildingsAsync();this.viewer.scene.primitives.add(t)}}const it=async()=>new Promise((a,t)=>{navigator.geolocation.getCurrentPosition(e=>a(e),e=>t(e))}),at=(a,t)=>{a.categories.forEach(e=>{e.groups.forEach(s=>{s.layers=s.layers.filter(i=>i.tags?i.tags.some(o=>o.includes(t)):!1),s.layers.length===0&&(e.groups=e.groups.filter(i=>i!==s))}),e.groups.length===0&&(a.categories=a.categories.filter(s=>s!==e))})},ot=(a,t)=>{let e=[];return a.categories.forEach(i=>{i.groups.forEach(o=>{o.layers.forEach(n=>{n.tags&&n.tags.forEach(r=>{r.includes(t)&&e.push(r)})})})}),[...new Set(e)]},nt=[self.location.hostname,"fonts.gstatic.com","fonts.googleapis.com","cdn.jsdelivr.net"],rt=a=>{var t=Date.now(),e=new URL(a.url);return e.protocol=self.location.protocol,e.hostname===self.location.hostname&&(e.search+=(e.search?"&":"?")+"cache-bust="+t),e.href};self.addEventListener("activate",a=>{a.waitUntil(self.clients.claim())});self.addEventListener("fetch",a=>{if(nt.indexOf(new URL(a.request.url).hostname)>-1){const t=caches.match(a.request),e=rt(a.request),s=fetch(e,{cache:"no-store"}),i=s.then(o=>o.clone());a.respondWith(Promise.race([s.catch(o=>t),t]).then(o=>o||s).catch(o=>{})),a.waitUntil(Promise.all([i,caches.open("pwa-cache")]).then(([o,n])=>o.ok&&n.put(a.request,o)).catch(o=>{}))}});class I extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.themes=this.getAttribute("themes"),this.themeBtn.setAttribute("themes",this.themes)}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="rail">
                <div class="menu">
                    <img src="/images/RAISE-pictogram-neg.svg" alt="RAISE pictogram" class="logo">
                    <app-drawer-toggle></app-drawer-toggle>
                    <app-icon-btn link="/"></app-icon-btn>
                </div>
            <app-theme-icon></app-theme-icon>
            </div>
            `,this.drawerToggle=this.shadow.querySelector("app-drawer-toggle"),this.themeBtn=this.shadow.querySelector("app-theme-icon"),this.drawerToggle.addEventListener("drawerToggled",e=>{this.setAttribute("is-open",e.detail.newValue)}),this.themeBtn.addEventListener("themeChanged",e=>{this.dispatchEvent(new CustomEvent("themeChanged",{detail:{newValue:e.detail.newValue}}))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/rail.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){s!=e&&(t=="themes"&&this.render(),t=="is-open"&&(this.drawerToggle.setAttribute("is-open",s+""),this.dispatchEvent(new CustomEvent("drawerToggled",{detail:{newValue:s}}))))}}d(I,"observedAttributes",["is-open","themes"]);customElements.define("app-rail",I);class H extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="icon">
                <span class="material-symbols-outlined">apps</span>
            </span>
            <span class="label">
                Layer
            </span>
            `,this.shadow.append(this.button),this.setAttribute("is-open","false");let t=this.getAttribute("is-open");this.btn=this.shadow.querySelector("button");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/drawer-toggle.css"),this.shadow.append(e),this.btn.addEventListener("click",()=>{t=this.getAttribute("is-open")==="true",this.setAttribute("is-open",!t+"")})}attributeChangedCallback(t,e,s){if(t=="is-open"){const i=new CustomEvent("drawerToggled",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i)}}}d(H,"observedAttributes",["is-open"]);customElements.define("app-drawer-toggle",H);class q extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){const t=JSON.parse(this.getAttribute("themes"));let e=0;this.setAttribute("current-theme",""),this.button.addEventListener("click",()=>{if(e=(e+1)%t.length,e===0)this.setAttribute("current-theme","");else{const s=JSON.stringify(t[e]);this.setAttribute("current-theme",s)}})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">contrast</span>
            `,this.shadow.append(this.button);const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/theme-icon.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){if(t=="themes"&&this.render(),t=="current-theme"&&s!=e&&e!=null&&s!=null){const i=new CustomEvent("themeChanged",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i)}}}d(q,"observedAttributes",["themes","current-theme"]);customElements.define("app-theme-icon",q);class J extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){let t=JSON.parse(this.getAttribute("data"));if(this.div.innerHTML="",localStorage.length!=0){let n=t,r=JSON.parse(localStorage.selectedTags);if(ht(n,r),O(n,this.div),t=n,t.categories.length==0){const l=document.createElement("p");l.innerText="Nessun livello trovato",this.div.append(l)}}else O(t,this.div);const e=this.shadow.querySelectorAll(".category-accordion"),s=this.shadow.querySelectorAll(".layer-accordion"),i=this.shadow.querySelectorAll("app-checkbox-list");ct(e,s);const o=[];i.forEach(n=>{n.addEventListener("checkboxListChanged",async r=>{const l=r.detail.input;await lt(l,o),JSON.parse(r.detail.newValue).forEach(h=>{o.push(h)}),this.setAttribute("active-layers",JSON.stringify(o))})}),i.forEach(n=>{n.addEventListener("routeTriggered",r=>{this.setAttribute("navigation-data",r.detail.newValue)})})}connectedCallback(){this.shadow.innerHTML=`
            <div id="categories-section"></div>
            `,this.div=this.shadow.querySelector("#categories-section"),this.setAttribute("navigation-data","[]")}attributeChangedCallback(t,e,s){if(s!=e){if(t=="data"&&this.render(),t=="active-layers"){const i=new CustomEvent("activeLayersChanged",{detail:{name:t,oldValue:e,newValue:JSON.parse(s)}});this.dispatchEvent(i)}if(t=="navigation-data"){s=="[]"&&this.shadow.querySelectorAll("app-checkbox-list").forEach(n=>n.setAttribute("navigation-data","[]"));const i=new CustomEvent("routeTriggered",{detail:{newValue:s}});this.dispatchEvent(i)}}}}d(J,"observedAttributes",["data","active-layers","navigation-data"]);customElements.define("app-drawer-content",J);function O(a,t){a.categories.forEach(e=>{const s=document.createElement("app-accordion");s.setAttribute("title",e.name),s.classList.add("category-accordion"),e.groups.forEach((i,o,n)=>{const r=document.createElement("app-accordion");o===n.length-1&&r.classList.add("last-accordion"),r.setAttribute("title",i.name),r.classList.add("layer-accordion");const l=document.createElement("app-checkbox-list");l.setAttribute("input",JSON.stringify(i.layers)),r.append(l),s.append(r),t.append(s)})})}function ct(a,t){a.forEach(e=>{e.addEventListener("accordionChanged",s=>{a.forEach(i=>{i!=s.target&&i.setAttribute("is-active","false")}),t.forEach(i=>{i.setAttribute("is-active","false")})})}),t.forEach(e=>{e.addEventListener("accordionChanged",s=>{t.forEach(i=>{i!=s.target&&i.setAttribute("is-active","false")})})})}function lt(a,t){a.forEach(e=>{const s=t.findIndex(i=>i.layer===e.layer);s!==-1&&t.splice(s,1)})}function ht(a,t){a.categories.forEach(e=>{e.groups.forEach(s=>{s.layers=s.layers.filter(i=>i.tags?t.some(o=>i.tags.includes(o)):!1),s.layers.length===0&&(e.groups=e.groups.filter(i=>i!==s))}),e.groups.length===0&&(a.categories=a.categories.filter(s=>s!==e))})}class R extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.input&&(this.input.setAttribute("value",this.getAttribute("value")),this.input.value=this.getAttribute("value"))}connectedCallback(){this.shadow.innerHTML=`
            <input type="search" name="search" id="search" placeholder="Cerca per livelli..." value="">
            `,this.input=this.shadow.querySelector("input");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/search.css"),this.shadow.append(t),this.input.addEventListener("input",()=>{this.setAttribute("value",this.input.value)})}attributeChangedCallback(t,e,s){const i=new CustomEvent("searchValueChanged",{detail:{name:t,oldValue:e,newValue:s}});s!=e&&(this.dispatchEvent(i),this.render())}}d(R,"observedAttributes",["value"]);customElements.define("app-searchbar",R);class D extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){if(this.tags=JSON.parse(this.getAttribute("data")),this.div.innerHTML="",this.tags)for(let t=0;t<this.tags.length;t++)this.span=document.createElement("span"),this.span.textContent=this.tags[t],this.span.setAttribute("name",this.tags[t]),this.span.setAttribute("tabindex",t+1),this.div.append(this.span);this.spans=this.shadow.querySelectorAll("span"),this.spans.forEach(t=>{t.addEventListener("click",()=>{this.setAttribute("selected",t.getAttribute("name"))})})}connectedCallback(){this.shadow.innerHTML=`
            <div></div>
            `,this.selectedSpan=0,this.div=this.shadow.querySelector("div"),this.setAttribute("selected","");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/autocomplete.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){if(t=="data"&&s!=e&&this.render(),t=="selected"&&s!=e){const i=new CustomEvent("autocompleteSelected",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i),this.div.innerHTML=""}t=="last-key-pressed"&&s!="Enter"&&s!="ArrowDown"&&s!="ArrowUp"&&(this.selectedSpan=0,this.render()),(t=="last-key-pressed"&&s=="ArrowUp"||s=="ArrowDown")&&(s=="ArrowDown"&&(this.selectedSpan++,this.selectedSpan==this.spans.length+1&&(this.selectedSpan=1),this.shadow.querySelector(`span[tabindex="${this.selectedSpan}"]`).focus()),s=="ArrowUp"&&(this.selectedSpan++,this.selectedSpan==this.spans.length+1&&(this.selectedSpan=1),this.shadow.querySelector(`span[tabindex="${this.selectedSpan}"]`).focus())),t=="last-key-pressed"&&s=="Enter"&&(this.setAttribute("selected",this.shadow.activeElement.getAttribute("name")),this.div.innerHTML="")}}d(D,"observedAttributes",["data","selected","last-key-pressed"]);customElements.define("app-autocomplete",D);class B extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.slots.forEach(t=>{t.assignedNodes().forEach(s=>{s.setAttribute("all-active",this.getAttribute("all-active"))})})}connectedCallback(){this.setAttribute("is-active","false"),this.setAttribute("all-active","false"),this.shadow.innerHTML=`
            
            <div class="accordion-item">

                <div class="accordion-checkbox">
                <input type="checkbox"></input>                

                <button type="button" class="accordion-btn">
                    <span class="accordion-title"></span>
                    <span class="accordion-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </span>
                </button>

                </div>

                <div class="accordion-content">
                    <slot></slot>
                </div>
            </div>
            `,this.accordionTitle=this.shadow.querySelector(".accordion-title"),this.accordionTitle&&(this.accordionTitle.textContent=this.title),this.accordionContent=this.shadow.querySelector(".accordion-content"),this.accordionIcon=this.shadow.querySelector(".accordion-icon");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/accordion.css"),this.shadow.append(t),this.accordionBtn=this.shadow.querySelector(".accordion-btn"),this.accordionBtn.addEventListener("click",()=>{this.accordionContent=this.shadow.querySelector(".accordion-content"),this.getAttribute("is-active")==="true"?(this.setAttribute("is-active","false"),this.accordionContent.classList.remove("accordion-show"),this.accordionIcon.classList.remove("accordion-icon-active")):(this.setAttribute("is-active","true"),this.accordionContent.classList.add("accordion-show"),this.accordionIcon.classList.add("accordion-icon-active"));const e=new CustomEvent("accordionChanged",{detail:{name:"is-active",oldValue:this.getAttribute("is-active"),newValue:this.getAttribute("is-active")}});this.dispatchEvent(e)}),this.classList.contains("last-accordion")&&this.accordionContent.classList.add("last-accordion"),this.checkbox=this.shadow.querySelector('input[type="checkbox"]'),this.getAttribute("all-active")=="true"?this.checkbox.checked=!0:this.checkbox.checked=!1,this.checkbox.addEventListener("change",e=>{const s=e.target.checked;this.setAttribute("all-active",s+"")}),this.slots=this.shadow.querySelectorAll("slot")}attributeChangedCallback(t,e,s){e!==null&&s!==null&&s!=e&&(t=="is-active"&&(this.getAttribute("is-active")==="true"?(this.accordionContent.classList.add("accordion-show"),this.accordionIcon.classList.add("accordion-icon-active")):(this.accordionContent.classList.remove("accordion-show"),this.accordionIcon.classList.remove("accordion-icon-active"))),t=="all-active"&&(this.getAttribute("all-active")=="true"?this.checkbox.checked=!0:this.checkbox.checked=!1,this.render()))}}d(B,"observedAttributes",["is-active","all-active"]);customElements.define("app-accordion",B);class z extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <div></div>
            `,this.div=this.shadow.querySelector("div"),this.setAttribute("all-active","false"),this.setAttribute("data","[]"),this.setAttribute("navigation-data","[]");const t=document.createElement("link");if(t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/checkbox-list.css"),this.shadow.append(t),!!this.hasAttribute("input")){this.input=JSON.parse(this.getAttribute("input")),this.data=this.getAttribute("data"),this.checkboxes=[];for(let e=0;e<this.input.length;e++)this.checkbox=document.createElement("app-checkbox"),this.checkbox.setAttribute("is-checked","false"),this.checkbox.setAttribute("data",JSON.stringify(this.input[e])),this.checkboxes.push(this.checkbox),this.div.append(this.checkbox);this.checkboxes.forEach(e=>{e.addEventListener("checkboxClicked",()=>{this.data=JSON.parse(this.getAttribute("data")),this.itemData=JSON.parse(e.getAttribute("data"));const s=this.data.findIndex(i=>i.layer===this.itemData.layer);s!==-1?this.data.splice(s,1):this.data.push(this.itemData),this.setAttribute("data",JSON.stringify(this.data))}),e.addEventListener("opacityChanged",s=>{this.data=JSON.parse(this.getAttribute("data")),this.itemData=JSON.parse(e.getAttribute("data")),this.itemData=JSON.parse(s.detail.newValue);const i=this.data.findIndex(o=>o.layer===this.itemData.layer);i!==-1?(this.data.splice(i,1),this.data.push(this.itemData)):this.data.push(this.itemData),this.setAttribute("data",JSON.stringify(this.data))}),e.addEventListener("routeTriggered",s=>{this.setAttribute("navigation-data",JSON.stringify(s.detail.data))}),e.addEventListener("detailStatusChanged",s=>{s.detail.newValue=="true"&&this.checkboxes.forEach(i=>{i!==e&&i.setAttribute("is-details-open","false")})})})}}attributeChangedCallback(t,e,s){if(this.allCheckboxes=this.shadow.querySelectorAll("app-checkbox"),s!=e&&e!==null&&s!==null){if(t=="data"){const i=new CustomEvent("checkboxListChanged",{detail:{name:t,oldValue:e,newValue:s,input:this.input}});this.dispatchEvent(i)}if(t=="all-active")if(this.checkboxes.forEach(i=>{i.setAttribute("is-checked",this.getAttribute("all-active"))}),this.getAttribute("all-active")=="true"){const i=[];this.allCheckboxes.forEach(o=>i.push(o.getAttribute("data"))),this.setAttribute("data",`[${i}]`)}else this.setAttribute("data","[]");if(t=="navigation-data"){s=="[]"&&this.allCheckboxes.forEach(o=>o.setAttribute("is-navigation-active","false"));const i=new CustomEvent("routeTriggered",{detail:{newValue:s}});this.dispatchEvent(i)}}}}d(z,"observedAttributes",["data","all-active","navigation-data"]);customElements.define("app-checkbox-list",z);class P extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <div class="checkbox">
                <input type="checkbox" id="checkbox">
                <div class="legend"></div>
                <label for="checkbox">Label</label>
            </div>                      
            `,this.checkbox=this.shadow.querySelector("input"),this.hasAttribute("is-checked")&&this.getAttribute("is-checked")=="true"?(this.setAttribute("is-checked",this.getAttribute("is-checked")),this.checkbox.checked=!0):(this.setAttribute("is-checked","false"),this.checkbox.checked=!1),this.label=this.shadow.querySelector("label"),this.hasAttribute("data")&&(this.label.innerHTML=JSON.parse(this.getAttribute("data")).name),this.legend=this.shadow.querySelector(".legend");const t=JSON.parse(this.getAttribute("data")).style.color;this.legend.style.backgroundColor=t;const e=JSON.parse(this.getAttribute("data")).components;if(e!=null&&e.length!=0){this.details=document.createElement("details"),this.details.innerHTML=`
                <summary>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>                
                </summary>
                `;for(const i of e)this.component=document.createElement(`${i}`),i=="app-opacity-slider"&&(this.opacity=JSON.parse(this.getAttribute("data")).style.opacity,this.component.setAttribute("opacity",this.opacity),this.component.addEventListener("opacityChanged",o=>{const n=JSON.parse(this.getAttribute("data"));n.style.opacity=o.detail.newValue,this.setAttribute("data",JSON.stringify(n))})),i=="app-navigation-btn"&&(this.setAttribute("is-navigation-active","false"),this.component.addEventListener("routeTriggered",()=>{this.setAttribute("is-navigation-active","true")})),this.details.append(this.component);this.shadow.append(this.details),this.setAttribute("is-details-open","false")}this.checkbox.addEventListener("click",i=>{const o=i.target.checked;this.setAttribute("is-checked",o+"");const n=JSON.parse(this.getAttribute("data")),r=new CustomEvent("checkboxClicked",{detail:{layer:n}});this.dispatchEvent(r)}),this.details&&this.details.addEventListener("toggle",i=>{i.target.open?this.setAttribute("is-details-open","true"):this.setAttribute("is-details-open","false")});const s=document.createElement("link");s.setAttribute("rel","stylesheet"),s.setAttribute("href","./css/checkbox.css"),this.shadow.append(s)}attributeChangedCallback(t,e,s){if(s!==e&&e!==null&&s!==null){if(t=="data"&&s!==e){const i=new CustomEvent("opacityChanged",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i)}if(t=="is-checked"&&(s=="true"?this.checkbox.checked=!0:this.checkbox.checked=!1,s=="false"&&this.setAttribute("is-navigation-active","false"),this.toolOpacity=this.shadow.querySelector("app-opacity-slider"),this.toolOpacity&&this.toolOpacity.setAttribute("is-enable",s),this.toolRoute=this.shadow.querySelector("app-navigation-btn"),this.toolRoute&&this.toolRoute.setAttribute("is-enable",s)),t=="is-details-open"){const i=new CustomEvent("detailStatusChanged",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i),this.getAttribute("is-details-open")=="true"?this.details.setAttribute("open",""):this.details.removeAttribute("open")}if(t=="is-navigation-active"){let i;s=="true"?i=JSON.parse(this.getAttribute("data")):i=JSON.parse("[]");const o=new CustomEvent("routeTriggered",{detail:{data:i}});this.dispatchEvent(o)}}}}d(P,"observedAttributes",["is-checked","data","is-details-open","is-navigation-active"]);customElements.define("app-checkbox",P);class F extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.getAttribute("is-enable")=="true"?this.input.disabled=!1:this.input.disabled=!0}connectedCallback(){this.shadow.innerHTML=`
            <div>
                <label>Opacit√†</label>
                <input type="range">
            </div>
            `,this.input=this.shadow.querySelector("input"),this.hasAttribute("is-enable")||(this.setAttribute("is-enable","false"),this.input.disabled=!0),this.input.setAttribute("min",0),this.input.setAttribute("max",1),this.input.setAttribute("step",.1),this.input.value=this.getAttribute("opacity"),this.input.addEventListener("change",()=>{this.setAttribute("opacity",this.input.value)});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/tool.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){if(t=="opacity"&&s!=e){const i=new CustomEvent("opacityChanged",{detail:{name:t,oldValue:e,newValue:s}});this.dispatchEvent(i)}t=="is-enable"&&e!==null&&s!==null&&s!==e&&this.render()}}d(F,"observedAttributes",["is-enable","opacity"]);customElements.define("app-opacity-slider",F);class _ extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <a href="${this.hasAttribute("link")?this.getAttribute("link"):"/"}">
                <span class="icon">
                    <span class="material-symbols-outlined">tag</span>
                </span>
                <span class="label">
                    Tags
                </span>
            </a>
            `,this.shadow.append(this.button);const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/icon.css"),this.shadow.append(t)}attributeChangedCallback(){}}d(_,"observedAttributes",[]);customElements.define("app-icon-btn",_);class U extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.isNavigation=this.getAttribute("is-navigation"),this.isNavigation=="true"?(this.icon.innerHTML="close",this.label.innerHTML="Chiudi navigazione"):(this.icon.innerHTML="directions",this.label.innerHTML="Avvia percorso")}connectedCallback(){this.hasAttribute("features")||this.setAttribute("features","[]"),this.hasAttribute("is-active")||this.setAttribute("is-active","false"),this.hasAttribute("is-navigation")||this.setAttribute("is-navigation","false"),this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">directions</span>
            <span class="label">Avvia percorso</span>
            `,this.shadow.append(this.button),this.icon=this.shadow.querySelector(".material-symbols-outlined"),this.label=this.shadow.querySelector(".label"),this.button.addEventListener("click",()=>{const e=JSON.parse(this.getAttribute("is-navigation"));this.setAttribute("is-navigation",!e+"")});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/navigation-btn.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){if(s!=e&&e!=null&&s!=null&&(t=="features"&&(s=="[]"?this.setAttribute("is-active","false"):this.setAttribute("is-active","true")),t=="is-active"&&(s=="true"?this.classList.add("visible"):this.classList.remove("visible")),t=="is-navigation")){const i=JSON.parse(this.getAttribute("features"));this.dispatchEvent(new CustomEvent("activateNavigation",{detail:{features:i,isNavigation:s}})),this.render()}}}d(U,"observedAttributes",["is-active","is-navigation","features"]);customElements.define("app-navigation",U);class G extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.data=JSON.parse(this.getAttribute("data")),this.category.innerText="",this.name.innerText="",this.tools.innerHTML="",this.content.innerHTML="";const t=this.data.properties;for(const s in t)if(t.hasOwnProperty(s)){const i=t[s];if(s=="Title"){this.category.innerText=i;continue}if(s=="Nome"){this.name.innerText=i;continue}const o=document.createElement("p");o.innerText=i,this.content.append(o)}if(this.playBtn=document.createElement("app-play-info-btn"),this.tools.append(this.playBtn),!this.data.coordinates||!typeof this.data.coordinates=="object")return;const e={};e.longitude=this.data.coordinates.longitude,e.latitude=this.data.coordinates.latitude,this.goToBtn=document.createElement("app-goto"),this.goToBtn.setAttribute("coordinates",JSON.stringify(e)),this.tools.insertBefore(this.goToBtn,this.playBtn),this.addToRouteBtn=document.createElement("app-add-to-route"),this.tools.insertBefore(this.addToRouteBtn,this.playBtn),this.goToBtn.addEventListener("goto",s=>{this.dispatchEvent(new CustomEvent("goto",{detail:s.detail.coordinates}))}),this.addToRouteBtn.addEventListener("click",()=>{this.data=JSON.parse(this.getAttribute("data")),this.dispatchEvent(new CustomEvent("addToRoute",{detail:{data:this.data}}))})}connectedCallback(){this.setAttribute("is-open","false"),this.setAttribute("data",""),this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="wrapper">
                <div class="close-icon">
                    <span class="material-symbols-outlined">close</span>
                </div>
                <div class="info">
                    <div class="title">
                        <h4 class="name"></h4>
                        <p class="category"></p>
                    </div>
                    <div class="tools">
                        <app-add-to-route></app-add-to-route>
                        <app-play-info-btn></app-play-info-btn>
                    </div>
                </div>
                <div class="content"></div>
            </div>
            `,this.close=this.shadow.querySelector(".close-icon"),this.info=this.shadow.querySelector(".info"),this.name=this.shadow.querySelector(".name"),this.category=this.shadow.querySelector(".category"),this.tools=this.shadow.querySelector(".tools"),this.content=this.shadow.querySelector(".content"),this.close.addEventListener("click",()=>this.setAttribute("is-open","false"));const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/info-drawer.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){s!=e&&s!=null&&e!=null&&(t=="is-open"&&(s=="true"?this.openDrawer():this.closeDrawer()),t=="data"&&(this.closeDrawer(),setTimeout(()=>{this.render(),this.openDrawer()},0)))}openDrawer(){this.classList.remove("close"),this.classList.add("open")}closeDrawer(){this.classList.remove("open"),this.classList.add("close")}}d(G,"observedAttributes",["is-open","data"]);customElements.define("app-info-drawer",G);class dt extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">play_circle</span>
            <span class="label">Ascolta</span>
            `,this.shadow.append(this.button);const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/play-info-btn.css"),this.shadow.append(t)}}customElements.define("app-play-info-btn",dt);class ut extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">directions</span>
            <span class="label">Indicazioni</span>
            `,this.shadow.append(this.button),this.button.addEventListener("click",()=>{this.coordinates=JSON.parse(this.getAttribute("coordinates"));const e=new CustomEvent("goto",{detail:{coordinates:this.coordinates}});this.dispatchEvent(e)});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/goto-btn.css"),this.shadow.append(t)}}customElements.define("app-goto",ut);class pt extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">add</span>
            <span class="label">Aggiungi a percorso</span>
            `,this.shadow.append(this.button),this.button.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("startNavigation"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/add-to-route-btn.css"),this.shadow.append(t)}}customElements.define("app-add-to-route",pt);const E=class E extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.features=JSON.parse(this.getAttribute("features")),this.div.innerHTML="",this.features.length!=0?(this.startNavigationBtn.setAttribute("features",JSON.stringify(this.features)),this.generateInfobox(this.div,this.features),this.allInfoboxes=this.shadow.querySelectorAll("app-path-infobox"),this.allInfoboxes.forEach(t=>{t.addEventListener("goto",e=>{this.dispatchEvent(new CustomEvent("goto",{detail:e.detail.coordinates}))})}),this.allInfoboxes.forEach(t=>{t.addEventListener("remove",e=>{let s=e.detail.data,i=this.checkFeature(s);this.setAttribute("features",JSON.stringify(i))})}),this.allInfoboxes.forEach(t=>{t.addEventListener("selectedFeature",e=>{let s=e.detail.data;this.dispatchEvent(new CustomEvent("selectedFeature",{detail:{data:s}}))})})):(this.startNavigationBtn.setAttribute("features","[]"),this.emptyMsg=document.createElement("app-empty-msg"),this.div.append(this.emptyMsg),this.emptyMsg.addEventListener("empty",()=>{this.dispatchEvent(new CustomEvent("empty")),this.setAttribute("is-open","false")}))}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="drawer">
                <div class="header">
                    <app-save-route-input></app-save-route-input>
                    <div class="header-tools">
                        <app-save-route-btn></app-save-route-btn>
                        <div class="close-icon">
                            <span class="material-symbols-outlined">close</span>
                        </div>
                    </div>
                </div>
                <div class="info-container"><app-empty-msg></app-empty-msg></div>
                <app-navigation></app-navigation>
            </div>
            `,this.closeIcon=this.shadow.querySelector(".close-icon"),this.saveRouteInput=this.shadow.querySelector("app-save-route-input"),this.saveRouteBtn=this.shadow.querySelector("app-save-route-btn"),this.div=this.shadow.querySelector(".info-container"),this.emptyMsg=this.shadow.querySelector("app-empty-msg"),this.startNavigationBtn=this.shadow.querySelector("app-navigation"),this.hasAttribute("features")||this.setAttribute("features","[]"),this.hasAttribute("route-name")||this.setAttribute("route-name","Nuovo percorso"),this.hasAttribute("is-navigation")||this.setAttribute("is-navigation","false"),this.setAttribute("is-open","false"),this.saveRouteBtn.addEventListener("saveCustomRoute",()=>{const e=this.saveRouteInput.getAttribute("value");let s={};s.name=e;const i=JSON.parse(this.getAttribute("features"));s.features=i,this.dispatchEvent(new CustomEvent("saveCustomRoute",{detail:{customRoute:s}}))}),this.closeIcon.addEventListener("click",()=>{this.setAttribute("is-open","false")}),this.startNavigationBtn.addEventListener("activateNavigation",e=>{E.features=e.detail.features;const s=e.detail.isNavigation;this.setAttribute("is-navigation",s+"")}),this.emptyMsg.addEventListener("empty",()=>{this.dispatchEvent(new CustomEvent("empty")),this.setAttribute("is-open","false")});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/path-drawer.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){if(s!=e&&e!=null){if(t=="is-open"&&(s=="true"?this.classList.add("visible"):this.classList.remove("visible"),this.dispatchEvent(new CustomEvent("pathDrawerStatusChanged",{detail:{newValue:s}}))),t=="is-navigation"){const i=E.features,o=s;this.dispatchEvent(new CustomEvent("activateNavigation",{detail:{features:i,isNavigation:o}})),this.startNavigationBtn.setAttribute("is-navigation",o+"")}t=="features"&&(this.setAttribute("is-open","true"),this.startNavigationBtn.setAttribute("is-navigation","false"),this.render()),t=="route-name"&&this.saveRouteInput.setAttribute("value",s)}}generateInfobox(t,e){for(let s=0;s<e.length;s++){const i=e[s],o=document.createElement("app-path-infobox");o.setAttribute("data",JSON.stringify(i)),s==e.length-1&&o.classList.add("last"),t.append(o)}}checkFeature(t){let e=JSON.parse(this.getAttribute("features"));const s=e.findIndex(i=>JSON.stringify(i.properties)==JSON.stringify(t.properties));return e.splice(s,1),e}};d(E,"features",[]),d(E,"observedAttributes",["is-open","is-navigation","features","route-name"]);let k=E;customElements.define("app-path-drawer",k);class mt extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <div>
                <img src="/images/undraw_my_current_location_re_whmt.svg" alt="Nessuna location">
                <h2>Ops!</h2>
                <p>Cerca dei punti di interesse ed aggiungili alla lista per iniziare il tuo percorso personalizzato.</p>
                <button>Aggiungi</button>
            </div>
            `,this.button=this.shadow.querySelector("button"),this.button.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("empty"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/empty-path-drawer-msg.css"),this.shadow.append(t)}}customElements.define("app-empty-msg",mt);const y=class y extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"}),y.counter++}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="wrapper">
                <div class="info">
                    <div class="order">
                        <div class="drag-icon">
                            <span class="material-symbols-outlined">drag_indicator</span>
                        </div>
                        <p class="index"></p>
                    </div>
                    <div class="title">
                        <h4 class="name"></h4>
                        <p class="category"></p>
                    </div>
                    <app-remove-btn></app-remove-btn>
                </div>
                <div class="content"></div>
            </div>
            `,this.data=JSON.parse(this.getAttribute("data")),this.info=this.shadow.querySelector(".info"),this.index=this.shadow.querySelector(".index"),this.name=this.shadow.querySelector(".name"),this.category=this.shadow.querySelector(".category"),this.removeBtn=this.shadow.querySelector("app-remove-btn");const t=this.data.properties;for(const s in t)if(t.hasOwnProperty(s)){const i=t[s];if(s=="Title"){this.category.innerText=i;continue}if(s=="Nome"){this.name.innerText=i;continue}}this.index.innerText=y.counter,this.removeBtn.addEventListener("remove",()=>{const s=new CustomEvent("remove",{detail:{data:this.data}});this.dispatchEvent(s)}),this.addEventListener("click",()=>{const s=new CustomEvent("selectedFeature",{detail:{data:this.data}});this.dispatchEvent(s)});const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./css/path-infobox.css"),this.shadow.append(e)}attributeChangedCallback(t,e,s){}disconnectedCallback(){y.counter--}};d(y,"counter",0),d(y,"observedAttributes",[]);let T=y;customElements.define("app-path-infobox",T);class bt extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.button=document.createElement("button"),this.button.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <span class="material-symbols-outlined">bookmark</span>
            `,this.shadow.append(this.button),this.button.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("saveCustomRoute"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/save-route-btn.css"),this.shadow.append(t)}}customElements.define("app-save-route-btn",bt);class $ extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.getAttribute("value")&&(this.input.value=this.getAttribute("value"))}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="container">
                <label for="title">
                    <span class="material-symbols-outlined">edit</span>
                </label>
                <input type="text" id="title">
            </div>
            `,this.input=this.shadow.querySelector("input"),this.getAttribute("value")||this.setAttribute("value","Nuovo percorso"),this.hasAttribute("value")&&(this.input.value=this.getAttribute("value")),this.input.addEventListener("input",()=>{this.setAttribute("value",this.input.value)});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/save-route-input.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){s!=e&&e!=null&&t=="value"&&this.render()}}d($,"observedAttributes",["value"]);customElements.define("app-save-route-input",$);class ft extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">close</span>
            `,this.shadow.append(this.button),this.button.addEventListener("click",e=>{e.stopPropagation(),this.dispatchEvent(new CustomEvent("remove"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/remove-btn.css"),this.shadow.append(t)}}customElements.define("app-remove-btn",ft);class W extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <div class="wrapper">
                <app-center-position></app-center-position>
                <app-zoom-btn></app-zoom-btn>
            </div>
            `,this.hasAttribute("is-route")||this.setAttribute("is-route","false"),this.positionBtn=this.shadow.querySelector("app-center-position"),this.zoomBtn=this.shadow.querySelector("app-zoom-btn"),this.positionBtn.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("centerPosition"))}),this.zoomBtn.addEventListener("zoomIn",()=>{this.dispatchEvent(new CustomEvent("zoomIn"))}),this.zoomBtn.addEventListener("zoomOut",()=>{this.dispatchEvent(new CustomEvent("zoomOut"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/map-controls.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){s!=e&&s!=null&&e!=null&&t=="is-route"&&(s=="true"?this.classList.add("visible"):this.classList.remove("visible"))}}d(W,"observedAttributes",["is-route"]);customElements.define("app-map-controls",W);class j extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            `,this.button=document.createElement("button"),this.button.innerHTML=`
            <span class="material-symbols-outlined">list</span>
            `,this.getAttribute("is-open")||this.setAttribute("is-open","false"),this.shadow.append(this.button),this.button.addEventListener("click",()=>{let e=JSON.parse(this.getAttribute("is-open"));this.setAttribute("is-open",!e+"")});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/path-drawer-toggle.css"),this.shadow.append(t)}attributeChangedCallback(t,e,s){s!=e&&s!=null&&e!=null&&t=="is-open"&&(this.dispatchEvent(new CustomEvent("togglePathDrawer",{detail:{newValue:s}})),s=="true"?this.classList.add("open"):this.classList.remove("open"))}}d(j,"observedAttributes",["is-open"]);customElements.define("app-path-drawer-toggle",j);class gt extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}connectedCallback(){this.button=document.createElement("button"),this.button.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <span class="material-symbols-outlined">my_location</span>
            `,this.shadow.append(this.button),this.button.addEventListener("click",()=>this.dispatchEvent(new CustomEvent("centerPosition")));const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/center-position-btn.css"),this.shadow.append(t)}}customElements.define("app-center-position",gt);class Y extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
            <div class="zoom-btns">
                <button class="zoom-in"><span class="material-symbols-outlined">add</span></button>
                <button class="zoom-out"><span class="material-symbols-outlined">remove</span></button>
            </div>
            `,this.zoomIn=this.shadow.querySelector(".zoom-in"),this.zoomOut=this.shadow.querySelector(".zoom-out"),this.zoomIn.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("zoomIn"))}),this.zoomOut.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("zoomOut"))});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","./css/zoom-button.css"),this.shadow.append(t)}attributeChangedCallback(){}}d(Y,"observedAttributes",[]);customElements.define("app-zoom-btn",Y);const vt="./json/categories.json",yt="./json/themes.json",S=document.querySelector("main"),M=document.querySelector("#drawer"),K=document.querySelector("app-searchbar"),N=document.querySelector("#drawer-title"),w=document.querySelector("app-drawer-content"),L=document.querySelector("app-autocomplete"),b=document.querySelector("app-path-drawer"),x=document.querySelector("app-path-drawer-toggle"),A=document.querySelector("app-map-controls"),C=document.querySelector("app-rail"),g=document.querySelector("app-info-drawer");document.querySelector("app-tag-selection");const u=new st;A.addEventListener("centerPosition",()=>u.setCameraToUserPosition(position));A.addEventListener("zoomIn",()=>u.viewer.camera.zoomIn(1e3));A.addEventListener("zoomOut",()=>u.viewer.camera.zoomOut(1e3));u.fetchThemes(yt).then(a=>C.setAttribute("themes",JSON.stringify(a)));C.addEventListener("themeChanged",a=>{const t=a.detail.newValue;u.changeTheme(t)});if(localStorage.customRoute){x.setAttribute("is-open","true"),A.setAttribute("is-route","true");let a=JSON.parse(localStorage.customRoute);b.setAttribute("route-name",a.name),b.setAttribute("features",JSON.stringify(a.features));const t=JSON.parse(localStorage.customRoute).features;let e=[];t.map(i=>e.push(i.layer));let s={};e.forEach(i=>{s[i]||(s[i]=!0)})}C.addEventListener("drawerToggled",a=>{a.detail.newValue=="true"?(g.setAttribute("is-open","false"),M.classList.add("drawer-open")):M.classList.remove("drawer-open")});g.addEventListener("goto",a=>{const t=a.detail;u.goto(t)});g.addEventListener("addToRoute",a=>{let t=JSON.parse(b.getAttribute("features")),e=a.detail.data;if(!t.some(s=>JSON.stringify(s)===JSON.stringify(e)))t.push(e);else{let s=document.createElement("app-snackbar");s.setAttribute("type","temporary"),s.setAttribute("text","Tappa gi√† presente nel percorso."),S.append(s)}b.setAttribute("features",JSON.stringify(t)),b.setAttribute("is-open","true")});u.viewer.screenSpaceEventHandler.setInputAction(a=>{u.mouseOver(a)},Cesium.ScreenSpaceEventType.MOUSE_MOVE);const X=[];for(let a=0;a<=2;a++)tt(a+2).then(t=>X.push(t));w.addEventListener("activeLayersChanged",async a=>{try{let t=document.createElement("app-snackbar");t.setAttribute("type","loader"),S.append(t),b.setAttribute("is-navigation","false"),await u.handleCheckbox(a.detail.newValue,X)}catch(t){console.error("Errore durante il recupero dei layer dal geoserver",t)}finally{document.querySelector('app-snackbar[type="loader"]').setAttribute("is-active","false")}});x.addEventListener("togglePathDrawer",a=>{const t=a.detail.newValue;b.setAttribute("is-open",t+"")});b.addEventListener("goto",a=>{const t=a.detail;u.goto(t)});b.addEventListener("pathDrawerStatusChanged",a=>{const t=a.detail.newValue;A.setAttribute("is-route",t+""),x.setAttribute("is-open",t+"")});b.addEventListener("empty",()=>C.setAttribute("is-open","true"));b.addEventListener("selectedFeature",a=>{const t=a.detail.data;u.setCameraToPosition(t.coordinates),g.setAttribute("data",JSON.stringify(t)),g.setAttribute("is-open","true")});b.addEventListener("saveCustomRoute",a=>{localStorage.setItem("customRoute",JSON.stringify(a.detail.customRoute));let t=document.createElement("app-snackbar");t.setAttribute("type","closable"),t.setAttribute("text",`Salvato percorso "${a.detail.customRoute.name}".`),S.append(t)});b.addEventListener("activateNavigation",a=>{if(a.detail.isNavigation=="true"){const t=a.detail.features;u.startNavigation(t)}else{const t=u.viewer.entities;u.removeAllEntities(t)}});L.addEventListener("autocompleteSelected",a=>{const t=a.detail.newValue;K.setAttribute("value",t)});document.addEventListener("keydown",a=>{L.setAttribute("last-key-pressed",a.key)});try{let a=document.createElement("app-snackbar");a.setAttribute("type","loader"),S.append(a),et(vt).then(t=>{w.setAttribute("data",JSON.stringify(t)),u.viewer.screenSpaceEventHandler.setInputAction(async e=>{C.setAttribute("is-open","false");const s=u.onClick(e,t);if(s==null){g.setAttribute("is-open","false"),b.setAttribute("is-open","false");return}g.setAttribute("data",`${JSON.stringify(s)}`),g.setAttribute("is-open","true")},Cesium.ScreenSpaceEventType.LEFT_CLICK),K.addEventListener("searchValueChanged",e=>{const s=e.detail.newValue.toLowerCase();N.textContent=`Livelli per: ${s}`;let i=JSON.parse(JSON.stringify(t));if(at(i,s),s=="")w.setAttribute("data",JSON.stringify(t)),N.textContent="Categorie";else if(w.setAttribute("data",JSON.stringify(i)),!w.innerHTML){const o=document.createElement("p");o.innerText=`Nessun livello trovato per ${s}`,w.append(o)}if(s.length>=2){const o=ot(t,s);L.setAttribute("data",JSON.stringify(o))}else L.setAttribute("data",JSON.stringify(""))})})}catch(a){console.error("Errore durante il recupero dei dati JSON",a)}finally{document.querySelector('app-snackbar[type="loader"]').setAttribute("is-active","false")}try{it().then(a=>{u.setCameraToUserPosition(a),u.createUserPin(a)})}catch(a){console.error(a),u.setCamera()}
