var P=Object.defineProperty;var J=(a,e,t)=>e in a?P(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>(J(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();class R{constructor(){const e=document.querySelector("app-map");this.viewer=new Cesium.Viewer(e,{baseLayerPicker:!1,geocoder:!1,timeline:!1,animation:!1,homeButton:!1,navigationInstructionsInitiallyVisible:!0,navigationHelpButton:!1,sceneModePicker:!1,fullscreenButton:!1}),this.toColor=!1,this.viewer.screenSpaceEventHandler.setInputAction(this.onClick.bind(this),Cesium.ScreenSpaceEventType.LEFT_CLICK)}static getImageryProvider(){return new Cesium.WebMapTileServiceImageryProvider({url:"https://c.basemaps.cartocdn.com/rastertiles/voyager/{TileMatrix}/{TileCol}/{TileRow}.png",layer:"carto-light",style:"default",format:"image/jpeg",maximumLevel:19,tileMatrixSetID:"default",credit:new Cesium.Credit('&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>')})}async onClick(e){const t=this.viewer.camera.getPickRay(e),s=this.viewer.imageryLayers.pickImageryLayerFeatures(t,this.viewer.scene);if(Cesium.defined(s))try{const i=await Promise.resolve(s);return console.log(`Number of features: ${i.length}`),i.length>0?i[0]:(console.log(null),null)}catch(i){return console.error("Errore nella raccolta delle features:",i),null}else return console.log("No features picked."),null}addLayer(e,t,s){const i=new Cesium.WebMapServiceImageryProvider({url:e,layers:t,parameters:s});this.viewer.imageryLayers.addImageryProvider(i)}removeLayer(e){const t=this.viewer.imageryLayers,s=t.length;for(let i=0;i<s;i++){const r=t.get(i);if(r._imageryProvider._layers===e){t.remove(r);return}}}removeAllLayers(){this.viewer.imageryLayers.removeAll()}getActiveLayers(){return this.viewer.imageryLayers._layers}setCamera(){const e=Cesium.Cartesian3.fromDegrees(8.909041078781357,44.410209942448475,4e3);this.viewer.camera.flyTo({destination:e,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:0}})}async addBuilding(){const e=await Cesium.createOsmBuildingsAsync();this.viewer.scene.primitives.add(e)}}const v=(a,e)=>{a.categories.forEach(t=>{const s=document.createElement("app-accordion");e.append(s),s.setAttribute("title",t.name),s.classList.add("category-accordion"),t.groups.forEach((i,r,o)=>{const n=document.createElement("app-accordion");r===o.length-1&&n.classList.add("last-accordion"),s.append(n),n.setAttribute("title",i.name),n.classList.add("layer-accordion");const p=document.createElement("app-checkbox-list");p.setAttribute("input",JSON.stringify(i.layers)),n.append(p)})})},D=(a,e)=>{a!=null?(e.setAttribute("data",JSON.stringify(a.properties)),e.classList.add("visible")):e.classList.remove("visible")},B=(a,e)=>{a.categories.forEach(t=>{t.groups.forEach(s=>{s.layers=s.layers.filter(i=>i.tags?i.tags.some(r=>r.includes(e)):!1),s.layers.length===0&&(t.groups=t.groups.filter(i=>i!==s))}),t.groups.length===0&&(a.categories=a.categories.filter(s=>s!==t))})};async function _(a){const e=await fetch(a).then(s=>s.json()),t=e.categories;for(const s of t){const i=[];for(let o=0;o<s.groups.length;o++){let n=s.groups[o];const p=await fetch(n).then(u=>{if(u)return u.json()}).catch(u=>console.log(u));i.push(p)}const r=await Promise.all(i).then(o=>o);s.groups.splice(0,s.groups.length),r.forEach(o=>{s.groups.push(o)})}return e}const w=(a,e,t,s,i)=>{a.forEach(r=>{r.addEventListener("checkboxListChanged",o=>{o.detail.input.forEach(c=>{const m=e.findIndex(g=>g.layer===c.layer);m!==-1&&e.splice(m,1)}),JSON.parse(o.detail.newValue).forEach(c=>{e.push(c)}),[...t.viewer.imageryLayers._layers].splice(1).forEach(c=>{t.removeLayer(c._imageryProvider._layers)});for(const c of e)c.hasOwnProperty("opacity")&&(i.opacity=c.opacity),t.addLayer(s,c.layer,i);console.log("Active layers:"),console.log(e)})})},A=(a,e)=>{a.forEach(t=>{t.addEventListener("accordionChanged",s=>{a.forEach(i=>{i!=s.target&&i.setAttribute("is-active","false")}),e.forEach(i=>{i.setAttribute("is-active","false")})})}),e.forEach(t=>{t.addEventListener("accordionChanged",s=>{e.forEach(i=>{i!=s.target&&i.setAttribute("is-active","false")})})})},$=(a,e)=>{let t=[];return a.categories.forEach(i=>{i.groups.forEach(r=>{r.layers.forEach(o=>{o.tags&&o.tags.forEach(n=>{n.includes(e)&&t.push(n)})})})}),[...new Set(t)]};class k extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <div>
                <input type="checkbox" id="checkbox">
                <label for="checkbox">Label</label>
            </div>

            <app-tool tool="range"></app-tool>
            `,this.checkbox=this.shadow.querySelector("input"),this.tool=this.shadow.querySelector("app-tool"),this.hasAttribute("is-checked")?this.setAttribute("is-checked",this.getAttribute("is-checked")):this.setAttribute("is-checked","false"),this.label=this.shadow.querySelector("label"),this.hasAttribute("data")&&(this.label.innerHTML=JSON.parse(this.getAttribute("data")).name),this.checkbox.addEventListener("change",t=>{const s=t.target.checked;this.setAttribute("is-checked",s+"")}),this.tool.addEventListener("opacityChanged",t=>{this.setAttribute("opacity",t.detail.newValue)});const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/checkbox/checkbox.css"),this.shadow.append(e),this.render()}attributeChangedCallback(e,t,s){if(e=="is-checked"&&t!==null&&s!==null&&s!==t){const i=new CustomEvent("checkboxChanged",{detail:{name:e,oldValue:t,newValue:s}});this.tool.setAttribute("is-enable",s),this.dispatchEvent(i)}if(e=="opacity"&&s!==t){const i=new CustomEvent("opacityChanged",{detail:{name:e,oldValue:t,newValue:s}});this.dispatchEvent(i)}}}h(k,"observedAttributes",["is-checked","opacity"]);customElements.define("app-checkbox",k);class C extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){if(!this.hasAttribute("input"))return;this.input=JSON.parse(this.getAttribute("input")),this.data=[];const e=[];for(let t=0;t<this.input.length;t++)this.checkbox=document.createElement("app-checkbox"),this.checkbox.setAttribute("is-checked","false"),this.checkbox.setAttribute("data",JSON.stringify(this.input[t])),e.push(this.checkbox),this.div.append(this.checkbox);e.forEach(t=>{t.addEventListener("checkboxChanged",()=>{this.itemData=JSON.parse(t.getAttribute("data"));const s=this.data.findIndex(i=>i.layer===this.itemData.layer);s!==-1?this.data.splice(s,1):this.data.push(this.itemData),this.setAttribute("data",JSON.stringify(this.data))})}),e.forEach(t=>{t.addEventListener("opacityChanged",s=>{this.itemData=JSON.parse(t.getAttribute("data")),this.itemData.opacity=s.detail.newValue;const i=this.data.findIndex(r=>r.layer===this.itemData.layer);i!==-1?(this.data.splice(i,1),this.data.push(this.itemData)):this.data.push(this.itemData),this.setAttribute("data",JSON.stringify(this.data))})})}connectedCallback(){this.shadow.innerHTML=`
            <div></div>
            `,this.div=this.shadow.querySelector("div");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/checkbox-list/checkbox-list.css"),this.shadow.append(e),this.render()}attributeChangedCallback(e,t,s){const i=new CustomEvent("checkboxListChanged",{detail:{name:"data",oldValue:t,newValue:s,input:this.input}});s!=t&&this.dispatchEvent(i)}}h(C,"observedAttributes",["data"]);customElements.define("app-checkbox-list",C);class S extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.setAttribute("data","")}render(){this.hasAttribute("data")&&(this.data=JSON.parse(this.getAttribute("data")),this.div.innerHTML="",Object.keys(this.data).forEach(e=>{const t=this.data[e];this.text=document.createElement("p"),this.text.innerHTML=`${e}: ${t}`,this.div.append(this.text)}))}connectedCallback(){this.shadow.innerHTML=`
            <div></div>
            <svg id="close-icon" viewPort="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <line x1="1" y1="11" x2="11" y2="1" stroke="black" stroke-width="2"/>
            <line x1="1" y1="1" x2="11" y2="11" stroke="black" stroke-width="2"/>
            </svg>
            `,this.div=this.shadow.querySelector("div");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/infobox/infobox.css"),this.shadow.append(e)}attributeChangedCallback(e,t,s){s!=t&&this.render()}}h(S,"observedAttributes",["data"]);customElements.define("app-infobox",S);class x extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.accordionTitle=this.shadow.querySelector(".accordion-title"),this.accordionTitle&&(this.accordionTitle.textContent=this.title),this.accordionContent=this.shadow.querySelector(".accordion-content"),this.accordionIcon=this.shadow.querySelector(".accordion-icon"),this.accordionContent&&(this.getAttribute("is-active")==="true"?(this.accordionContent.classList.add("accordion-show"),this.accordionIcon.classList.add("accordion-icon-active")):(this.accordionContent.classList.remove("accordion-show"),this.accordionIcon.classList.remove("accordion-icon-active")),this.classList.contains("last-accordion")&&this.accordionContent.classList.add("last-accordion"))}connectedCallback(){this.setAttribute("is-active","false"),this.shadow.innerHTML=`
            <div class="accordion-item">
                <button type="button" class="accordion-btn">
                    <span class="accordion-title"></span>
                    <span class="accordion-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </span>
                </button>
                <div class="accordion-content">
                    <slot></slot>
                </div>
            </div>
            `;const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/accordion/accordion.css"),this.shadow.append(e),this.accordionBtn=this.shadow.querySelector(".accordion-btn"),this.accordionBtn.addEventListener("click",()=>{this.accordionContent=this.accordionBtn.nextElementSibling,this.getAttribute("is-active")==="true"?this.setAttribute("is-active","false"):this.setAttribute("is-active","true");const t=new CustomEvent("accordionChanged",{detail:{name:"is-active",oldValue:this.getAttribute("is-active"),newValue:this.getAttribute("is-active")}});this.dispatchEvent(t)})}attributeChangedCallback(e,t,s){e=="title"&&s!=t&&this.render(),e=="is-active"&&s!=t&&this.render()}}h(x,"observedAttributes",["title","is-active"]);customElements.define("app-accordion",x);class T extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.input&&(this.input.setAttribute("value",this.getAttribute("value")),this.input.value=this.getAttribute("value"))}connectedCallback(){this.shadow.innerHTML=`
            <input type="search" name="search" id="search" placeholder="Cerca per livelli..." value="">
            `,this.input=this.shadow.querySelector("input");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/search/search.css"),this.shadow.append(e),this.input.addEventListener("input",()=>{this.setAttribute("value",this.input.value)})}attributeChangedCallback(e,t,s){const i=new CustomEvent("searchValueChanged",{detail:{name:e,oldValue:t,newValue:s}});s!=t&&(this.dispatchEvent(i),this.render())}}h(T,"observedAttributes",["value"]);customElements.define("app-searchbar",T);class M extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){}connectedCallback(){this.shadow.innerHTML=`
            <a id="menu-toggle" class="menu-toggle">
                <span class="menu-toggle-bar menu-toggle-bar--top"></span>
                <span class="menu-toggle-bar menu-toggle-bar--middle"></span>
                <span class="menu-toggle-bar menu-toggle-bar--bottom"></span>
            </a>
            `,this.setAttribute("is-open","false");let e=this.getAttribute("is-open");this.a=this.shadow.querySelector("a");const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","src/components/drawer-toggle/drawer-toggle.css"),this.shadow.append(t),this.a.addEventListener("click",()=>{e=this.getAttribute("is-open")==="true",this.setAttribute("is-open",!e+"")})}attributeChangedCallback(e,t,s){if(e==="is-open"){this.a&&(s==="true"?this.a.classList.add("nav-open"):this.a.classList.remove("nav-open"));const i=new CustomEvent("drawerToggled",{detail:{name:e,oldValue:t,newValue:s}});this.dispatchEvent(i)}}}h(M,"observedAttributes",["is-open"]);customElements.define("app-drawer-toggle",M);class q extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){if(this.tags=JSON.parse(this.getAttribute("data")),this.div.innerHTML="",this.tags)for(let e=0;e<this.tags.length;e++)this.span=document.createElement("span"),this.span.textContent=this.tags[e],this.span.setAttribute("name",this.tags[e]),this.span.setAttribute("tabindex",e+1),this.div.append(this.span);this.spans=this.shadow.querySelectorAll("span"),this.spans.forEach(e=>{e.addEventListener("click",()=>{this.setAttribute("selected",e.getAttribute("name"))})})}connectedCallback(){this.shadow.innerHTML=`
            <div></div>
            `,this.selectedSpan=0,this.div=this.shadow.querySelector("div"),this.setAttribute("selected","");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/autocomplete/autocomplete.css"),this.shadow.append(e)}attributeChangedCallback(e,t,s){if(e=="data"&&s!=t&&this.render(),e=="selected"&&s!=t){const i=new CustomEvent("autocompleteSelected",{detail:{name:e,oldValue:t,newValue:s}});this.dispatchEvent(i),this.div.innerHTML=""}e=="last-key-pressed"&&s!="Enter"&&s!="ArrowDown"&&s!="ArrowUp"&&(this.selectedSpan=0,this.render()),(e=="last-key-pressed"&&s=="ArrowUp"||s=="ArrowDown")&&(s=="ArrowDown"&&(this.selectedSpan++,this.selectedSpan==this.spans.length+1&&(this.selectedSpan=1),this.shadow.querySelector(`span[tabindex="${this.selectedSpan}"]`).focus()),s=="ArrowUp"&&(this.selectedSpan++,this.selectedSpan==this.spans.length+1&&(this.selectedSpan=1),this.shadow.querySelector(`span[tabindex="${this.selectedSpan}"]`).focus())),e=="last-key-pressed"&&s=="Enter"&&(this.setAttribute("selected",this.shadow.activeElement.getAttribute("name")),this.div.innerHTML="")}}h(q,"observedAttributes",["data","selected","last-key-pressed"]);customElements.define("app-autocomplete",q);class O extends HTMLElement{constructor(){super(),this.shadow=this.attachShadow({mode:"closed"})}render(){this.getAttribute("is-enable")=="true"?this.input.disabled=!1:this.input.disabled=!0}connectedCallback(){this.shadow.innerHTML=`
            <details>
                <summary>
                    Opacità
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>                
                </summary>

                <input type="${this.getAttribute("tool")}">
            </details>
            `,this.setAttribute("is-enable","false"),this.input=this.shadow.querySelector("input"),this.getAttribute("is-enable")=="false"&&(this.input.disabled=!0),this.getAttribute("tool")=="range"&&(this.input.setAttribute("min",0),this.input.setAttribute("max",1),this.input.setAttribute("step",.1),this.input.value=1,this.input.addEventListener("change",()=>{this.setAttribute("opacity",this.input.value)}));const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","src/components/tool/tool.css"),this.shadow.append(e)}attributeChangedCallback(e,t,s){if(e=="opacity"&&s!=t){const i=new CustomEvent("opacityChanged",{detail:{name:e,oldValue:t,newValue:s}});this.dispatchEvent(i)}e=="is-enable"&&t!==null&&s!==null&&s!==t&&this.render()}}h(O,"observedAttributes",["is-enable","opacity"]);customElements.define("app-tool",O);const F="../json/categories.json",b=new R,L="https://mappe.comune.genova.it/geoserver/wms",E={format:"image/png",transparent:!0};b.setCamera();_(F).then(a=>{const e=document.querySelector("#categories-section");v(a,e);const t=document.querySelector("app-drawer-toggle"),s=document.querySelector("#drawer"),i=document.querySelector("app-infobox"),r=i.shadowRoot.querySelector("#close-icon"),o=document.querySelectorAll("app-checkbox-list"),n=document.querySelectorAll(".category-accordion"),p=document.querySelectorAll(".layer-accordion"),u=document.querySelector("app-searchbar"),c=document.querySelector("#drawer-title"),m=document.querySelector("app-autocomplete");t.addEventListener("drawerToggled",d=>{d.detail.newValue=="true"?s.classList.add("drawer-open"):s.classList.remove("drawer-open")}),b.viewer.screenSpaceEventHandler.setInputAction(function(d){b.onClick(d.position).then(l=>{console.log(l),t.setAttribute("is-open","false"),D(l,i)})},Cesium.ScreenSpaceEventType.LEFT_CLICK),r.addEventListener("click",()=>{i.classList.remove("visible")}),s.addEventListener("click",()=>{i.classList.remove("visible")}),t.addEventListener("click",()=>{i.classList.remove("visible")});const g=[];w(o,g,b,L,E),A(n,p),u.addEventListener("searchValueChanged",d=>{e.innerHTML="";const l=d.detail.newValue;c.textContent=`Livelli per: ${l}`;let y=JSON.parse(JSON.stringify(a));if(B(y,l),l=="")v(a,e),c.textContent="Categorie";else if(v(y,e),!e.innerHTML){const f=document.createElement("p");f.innerText=`Nessun livello trovato per ${l}`,e.append(f)}const H=document.querySelectorAll("app-checkbox-list");w(H,g,b,L,E);const I=document.querySelectorAll(".category-accordion"),N=document.querySelectorAll(".layer-accordion");if(A(I,N),l.length>=2){const f=$(a,l);m.setAttribute("data",JSON.stringify(f))}else m.setAttribute("data",JSON.stringify(""))}),m.addEventListener("autocompleteSelected",d=>{const l=d.detail.newValue;u.setAttribute("value",l)}),document.addEventListener("keydown",d=>{m.setAttribute("last-key-pressed",d.key)})});
